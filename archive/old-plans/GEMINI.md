# GEMINI.md: Legacy AI Instructions (Superseded by CLAUDE.md)

**Note**: This document has been superseded by the more comprehensive `CLAUDE.md` which contains updated instructions including:
- TeX Gyre Pagella typography system (replacing Bembo/fbb)
- Optimized small caps, spacing, and heading hierarchy for Pagella
- Professional appendix management system
- Enhanced mathematical typography with newpxmath
- Updated baseline grid and microtype settings

Please refer to `CLAUDE.md` for all current typography and system specifications.

This document provides the legacy guiding principles for the Gemini AI agent. Your role is to act as an expert academic typesetter, a proficient data analyst, and a meticulous repository manager. The ultimate goal is to produce a beautiful, typographically slick paper that is fully reproducible.

**Core Philosophy:** This project prioritizes typographic excellence, maintainable code, and reproducible research. When in doubt, defer to the principles in Robert Bringhurst's "The Elements of Typographic Style."

---

## 1. Master Repository Structure

This project is a **GitHub repository**. The directory structure is essential. When scaffolding the project, create these directories and place an empty `.gitkeep` file in any directory that might start empty (`/data/raw`, `/data/processed`, `/figures`) to ensure they are tracked by Git.

-	`/`: The root directory.
-		`CLAUDE.md`, `GEMINI.md`, `main.tex`, `references.bib`
-	`/paper/`: Contains all LaTeX source files for the paper's content.
-	`/appendices/`: Contains all appendix files (see CLAUDE.md for current system).
-	`/src/`: Contains all source code scripts (`py/`, `sh/`).
-	`/data/`: Contains raw and processed data files.
-	`/figures/`: Contains all final plots and figures generated by Python.

---

## 2. LaTeX & Typography: The Rules of the Page

This is the most critical section. The output must be professional and aesthetically pleasing. All typographic and layout rules are codified in the `paper/paperstyle.sty` file, which synthesizes three foundational works:

- **Matthew Butterick's *Practical Typography*** - Professional polish, baseline grids, and optimal reading
- **Tim Brown's *Modular Scale*** (modularscale.com) - Mathematical harmony through proportional sizing  
- **Jost Hochuli's *Detail in Typography*** - Micro-refinements and archival-quality typesetting

### Core Typographic Philosophy

**Foundation (Butterick's Practical Typography):**
- **Text Font:** 11pt fbb (Bembo revival) with complete Renaissance features (altP, osf, p, sups, swashQ)
- **Mathematical Typography:** newtxmath with libertine option provides harmonized serif mathematics
- **Monospace Typography:** Inconsolata (zi4) scaled to 93% with microtype optimization for code integration
- **Symbol Collections:** mathalfa enhancements (Boondoxo calligraphic, Boondox blackboard bold/fraktur)
- **Optimized Baseline Grid:** 12.65pt rhythm (11pt × 1.15 leading) fine-tuned for Bembo's tall ascenders
- **Line Length:** 45-90 characters (optimal reading with 1.25" margins ≈ 65 chars)
- **Paragraphs:** Classical indentation (12pt ≈ 1.1em for Bembo) with flush left first paragraphs after headings

**Mathematical Harmony (Tim Brown's Modular Scale):**
- **Scale Ratio:** Perfect Fourth (1.333) creates natural, pleasing hierarchy
- **Size Progression:** 11pt → 12pt → 14pt → 18pt (proportionally derived)
- **Systematic Spacing:** All vertical rhythms calculated from base × scale ratios

**Micro-Refinements (Hochuli's Detail in Typography):**
Hochuli's 1987 masterwork emphasizes that "typography should be invisible to the reader" while achieving technical perfection:
- **Enhanced Microtype:** factor=1100 character protrusion, conservative stretch/shrink=10 for word spacing flexibility
- **Typeface-Specific Optimization:** Conservative 3% tracking for small caps, 5% for bold small caps (respects Bembo's inherent spacing)
- **Bembo Line Spacing:** 1.15 linespread optimized for tall ascenders with 12.65pt baseline grid
- **Professional Dash Spacing:** Em-dash (400/400) and en-dash (300/300) space units for optimal rhythm
- **Enhanced fbb Features:** Full Renaissance Bembo feature set (altP, osf, p, sups, swashQ)
- **Bold Small Caps Optimization:** Generous 4.5% tracking for weight distribution, 0.97× scaling for optical balance
- **Contextual Commands:** `\bsc{}`, `\headsc{}`, `\inlinebsc{}`, `\balancedbsc{}` for different applications
- **Weight Compensation:** Subtle color adjustment (black!92) for heavy bold small caps in headings
- **Archival Quality:** Aggressive widow/orphan prevention (10000 penalty), intelligent hyphenation
- **Detail Obsession:** Every measurement serves readability—from 0.4pt footnote rules to 6.325pt baseline spacing

### Bibliography and Citation System

**Primary System (`preamble.tex`):**
```latex
\usepackage[backend=biber,style=chicago-authordate,natbib=true]{biblatex}
\addbibresource{references.bib}
```

**Legacy Fallback (`preamble-natbib.tex`):**
```latex
\usepackage[authoryear,round,semicolon]{natbib}
\bibliographystyle{chicago}
```

### Preamble and Packages
-	**Primary System:** Use **`biblatex`** with `biber` backend and `chicago-authordate` style.
-	**Legacy Support:** Alternative `preamble-natbib.tex` for traditional natbib workflow.
-	**Custom Style:** The project's typographic rules are loaded via `\usepackage{paper/paperstyle}`.

### Typographic Mandates
-   **Tables:** Use `booktabs`. **Never use vertical lines.** Place captions **above** table content.
-   **Figures:** Use `graphicx` with `[tbp]` placement. Place captions **below** figure content.
-   **Float Control:** Use `\FloatBarrier` before major section breaks to prevent drift.
-   **Quotations:** Use `csquotes` package with `\enquote{}` for context-sensitive quotation marks.
-   **Dashes & Quotes:** Use the correct LaTeX syntax for dashes (`-`, `--`, `---`) and smart quotes via `csquotes`.
-   **Non-Breaking Spaces (`~`):** Use before citations (`~\cite{...}`) and references (`Figure~\ref{...}`).
-	**Link Colors:** All links and references (internal, citations, external URLs, files) are rendered in professional navy blue `RGB(0,102,180)` for consistent visual treatment and enhanced accessibility. All link borders are disabled for clean appearance.


### Section Heading Styles
All section headings follow Tim Brown's modular scale (Perfect Fourth ratio 1.333) and are systematically derived from the 11pt base. Vertical spacing follows Butterick's baseline grid principles.

| Heading Level     | Font Size | Scale Factor | Leading | Space Above | Space Below | Style Notes |
| :---------------- | :-------- | :----------- | :------ | :---------- | :---------- | :---------- |
| `\section`        | 18pt      | 1.333³       | 22pt    | 24pt        | 15pt        | Bold, -1% tracking |
| `\subsection`     | 14pt      | 1.333¹       | 17pt    | 18pt        | 12pt        | Bold, -1% tracking |
| `\subsubsection`  | 12pt      | 1.333^0.5    | 14.5pt  | 14pt        | 10pt        | Bold, -1% tracking |
| `\paragraph`      | 11pt      | 1.0 (base)   | 13.75pt | 12pt        | 6pt         | Small caps, +8% tracking |

**Mathematical Basis:** All sizes derive from 11pt × 1.333^n, ensuring visual harmony. The `\paragraph` command is unnumbered, runs into text, uses 25% gray color (enhanced from 30% for better accessibility), and receives automatic letterspacing per Hochuli's recommendations.

### Footnote System
The footnote system implements all three masters' principles for maximum readability and professional appearance:

**Size Hierarchy (Brown's Modular Scale):**
- **Superscript:** 8pt (11pt ÷ 1.375) with old-style numerals
- **Footnote Text:** 9pt (11pt ÷ 1.2) with 11pt leading
- **Hanging Indent:** 1.5em for optimal visual balance

**Spacing System (Hochuli's Optimized Baseline Grid):**
- **Above footnotes:** 12.65pt (1 baseline unit, optimized for Bembo)
- **Between footnotes:** 6.325pt (0.5 baseline unit)
- **Footnote rule:** 2in width, 0.4pt height for subtle elegance

**Refinements (Hochuli's Details):**
- **Word spacing:** Tighter 0.3em for small text optimal readability
- **Orphan prevention:** 10000 penalty prevents footnote page breaks
- **Mark protection:** Automatic `\nobreak` prevents awkward line breaks
- **Smart punctuation:** `fnpct` package handles complex punctuation cases

### Professional Figures and Tables System

The framework provides comprehensive support for academic figures and tables following Chicago Manual of Style guidelines and professional typographic standards.

**Essential Packages (with clear explanations):**
- **`graphicx`:** Graphics inclusion and manipulation capabilities
- **`booktabs`:** Professional table design eliminating all vertical rules
- **`tabularx`:** Tables that automatically stretch to full text width
- **`longtable` + `ltcaption`:** Multi-page tables with consistent caption formatting
- **`placeins`:** Float barriers for precise sectional control
- **`csquotes`:** Context-sensitive quotation marks with automatic nesting
- **`hyperref`:** Enhanced PDF links with hidelinks option for print compatibility
- **`cleveref`:** Intelligent cross-referencing (must load after hyperref)

**Figure Implementation:**
```latex
\begin{figure}[tbp]  % Recommended: top, bottom, page placement
  \centering
  \includegraphics[width=0.8\textwidth]{figures/example.pdf}
  \caption{Caption Below Figure (Chicago Standard)}
  \label{fig:descriptive-label}
\end{figure}
```

**Professional Table Design:**
```latex
\begin{table}[tbp]  % Consistent [tbp] placement
  \caption{Caption Above Table (Chicago Standard)}
  \label{tab:descriptive-label}
  \centering
  \begin{tabular}{@{}lrrr@{}}  % @{} removes default padding
    \toprule  % Top rule only
    Method & Accuracy & Precision & Recall \\
    \midrule  % Separator rule
    Data & 0.85 & 0.82 & 0.87 \\
    \bottomrule  % Bottom rule only
  \end{tabular}
\end{table}
```

**Full-Width Tables with TabularX:**
```latex
\begin{table}[tbp]
  \caption{Extended Analysis Results}
  \label{tab:extended}
  \centering
  \begin{tabularx}{\textwidth}{@{}lXrr@{}}  % X column expands
    \toprule
    Method & Description & Time & Accuracy \\
    \midrule
    A & Long description that automatically wraps & 120ms & 0.85 \\
    \bottomrule
  \end{tabularx}
\end{table}
```

**Multi-Page Tables:**
```latex
\begin{longtable}{@{}lrrr@{}}
  \caption{Dataset Analysis Results} \label{tab:long} \\
  \toprule Dataset & Size & Accuracy & Time \\ \midrule \endfirsthead
  
  \multicolumn{4}{@{}l}{\tablename\ \thetable\ -- continued} \\
  \toprule Dataset & Size & Accuracy & Time \\ \midrule \endhead
  
  \midrule \multicolumn{4}{@{}r}{continued on next page} \endfoot
  \bottomrule \endlastfoot
  
  % Table rows here...
\end{longtable}
```

**Float Control Best Practices:**
- **Placement Options:** Use `[tbp]` (top, bottom, page) - **avoid `[h]` (here)**
- **Section Control:** Insert `\FloatBarrier` before major section breaks
- **Professional Layout:** Framework sets optimal float placement ratios
- **Multi-Float Pages:** Maximum 3 top floats, 2 bottom floats per page

**Caption and Reference Standards:**
- **Tables:** Captions **above** content (Chicago Manual of Style)
- **Figures:** Captions **below** content (Chicago Manual of Style)
- **Typography:** 10pt sizing (modular scale: 11pt × 0.9) with hanging indents
- **Cross-References:** Use `\ref{fig:name}` and `\ref{tab:name}` with non-breaking spaces

### Professional Citation Implementation

**Core Citation Commands (biblatex primary system):**
```latex
\textcite{key}                    % Textual citations
\autocite{key}                    % Parenthetical citations  
\textcite[45--48]{key}           % Page references
\autocite[see also][]{key}       % Pre-notes
\autocite[][chap. 3]{key}        % Post-notes
\textcite{key1,key2,key3}        % Multiple sources
```

**Bibliography Database Examples:**
```bibtex
% Standard article with DOI
@article{smith2023typography,
  title = {Modern Academic Typography},
  author = {Jane A. Smith and Robert Johnson},
  journal = {Design Studies},
  volume = {15},
  pages = {245--267},
  year = {2023},
  doi = {10.1000/journal.example.2023},
  annotation = {Comprehensive analysis of typography systems.}
}

% Online resource
@online{consortium2023,
  title = {Web Typography Standards},
  author = {{Typography Consortium}},
  url = {https://typography.edu/standards},
  urldate = {2025-06-28},
  year = {2023}
}

% Preprint with arXiv
@misc{rodriguez2023ml,
  title = {Machine Learning Typography},
  author = {Emma Rodriguez and Thomas Kim},
  eprint = {2301.12345},
  eprinttype = {arxiv},
  year = {2023}
}
```

**Enhanced Digital Features:**
- **DOI Links:** Automatic formatting with professional navy blue
- **URL Integration:** Consistent link styling with framework colors
- **arXiv Support:** Preprint server integration
- **Spacing Alignment:** Bibliography follows 12.65pt baseline grid
- **Natbib Compatibility:** Legacy `\citet{}` and `\citep{}` commands available

**Migration Support:**
- Use `preamble-natbib.tex` for legacy natbib systems
- Replace `\citet{}` → `\textcite{}` and `\citep{}` → `\autocite{}`
- Enhanced bibliography database with DOI, URL, and annotation fields



### Writing and Citation Style
-   **Style:** Formal academic tone, following the **Chicago Manual of Style (17th Edition, author-date system)**.
-   **Bibliography:** The bibliography source is `references.bib`.

### LaTeX Source Code Style
To ensure clarity, consistency, and maintainability of the `.tex` source files, you must adhere to the following rules without exception.

**1. Formatting & Readability:**
-   **Indentation:** Use 2 spaces for indentation within all environments (e.g., `figure`, `itemize`).
-   **One Sentence Per Line:** Always write one sentence per physical line in your editor. This is critical for version control diffs.
-   **Math Spacing:** Use spaces around binary operators and relations in math mode for readability (e.g., `$x = y + z$`, not `$x=y+z$`).

**2. Semantic Commands:**
-   **Emphasis:** For emphasis, you **must** use the semantic `\emph{}` command. It correctly handles nested emphasis and adapts to the surrounding context. Use `\textit{}` only when you specifically need italic text for presentational, non-emphatic reasons.
-   **Custom Macros:** For repeated or complex notation, define semantic macros in `preamble.tex` (e.g., `\newcommand{\R}{\mathbb{R}}`).

**3. Labeling Conventions:**
All labels (`\label{...}`) **must** be systematic, descriptive, and use the following prefixes.

| Prefix    | Element Type            |
| :-------- | :---------------------- |
| `sec:`    | Sections                |
| `subsec:` | Subsections             |
| `fig:`    | Figures                 |
| `tab:`    | Tables                  |
| `eq:`     | Equations               |
| `alg:`    | Algorithms              |
| `lst:`    | Code Listings           |
| `thm:`    | Theorems, Lemmas, Props |
| `def:`    | Definitions             |
| `app:`    | Appendices              |

**Labeling Best Practices:**
-   **Descriptive Names:** Labels must describe the element (e.g., `fig:pollinator-distribution`, not `fig:1`).
-   **Consistent Format:** Use lowercase letters and hyphens (`-`) to separate words.
-   **No Special Characters:** Never use spaces or special LaTeX characters in labels.

---

## 3. Python & Data Analysis

### Environment & Style
-   **Core Libraries:** `pandas`, `matplotlib`, `seaborn`, `scipy`.
-   **Style:** Code must be compliant with **PEP 8** and strictly formatted using the **`black`** auto-formatter.

### Plotting Mandate
-   **Aesthetics:** Use `seaborn` with the `seaborn-v0_8-paper` style.
-   **Clarity:** Clear axis labels and a descriptive title.
-   **Color:** Use the `'viridis'` or another colorblind-friendly colormap.
-   **Output:** Save all figures as 1500 DPI PNGs and PDFs inside the `/figures/` directory.

---

## 4. Shell Scripting

When generating scripts, you must adhere to the **Google Shell Style Guide** and start every script with the "Unofficial Strict Mode" boilerplate (`set -o errexit nounset pipefail`).

---

## 5. General Code Principles

For any other code or configuration file (e.g., `Makefile`, `Dockerfile`), default to the principles of the relevant **Google Style Guide**, prioritizing readability, consistency, and useful comments.

---

## 6. General Agent Instructions

-   **Persona:** Expert academic typesetter, data analyst, and repository manager.
-   **Prime Directive:** Prioritize clarity, reproducibility, and the typographic and code style rules defined in this document.
-   **Explain Yourself:** Briefly explain the reasoning behind significant stylistic or structural decisions.
